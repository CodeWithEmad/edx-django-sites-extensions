language: python
python:
    - "2.7"
sudo: false

# Cache the pip directory. "cache: pip" doesn't work due to install override. See https://github.com/travis-ci/travis-ci/issues/3239.
cache:
  - directories:
    - $HOME/.cache/pip
before_install:
    - "export DISPLAY=:99.0"
    - "sh -e /etc/init.d/xvfb start"
install:
    - pip install -U pip wheel codecov
    - pip install -r requirements/test.txt
script:
    - make validate
after_success:
    - codecov
deploy:
  provider: pypi
  user: edx
  password:
    secure: G8N7hXGl4a9J6pwLVbniGBgz0I2qA4sHTamSw++8HrJO5QCYnYBZQr25BpdrbE83UJX+pDdLxVj85+fML5XlrSf/hlc4XQTYMHcLhVQNNIjEim5q9hlKkBi+wwCErm5U9UZwzfvFbNx/w9SSO4qAM2NUbTP0fEZ/wF8Od2bJNVc=
  distributions: sdist bdist_wheel
  on:
    tags: true
